---
x-base: &base
  image: ${testnet}:latest
  restart: unless-stopped
  cap_add:
    - NET_ADMIN
  logging:
    driver: "loki"
    options:
      mode: non-blocking
      loki-url: "http://127.0.0.1:3100/loki/api/v1/push"
      loki-retries: "5"
  build:
    context: "../../"
    # Binary version
    #dockerfile: "cardano-node/Dockerfile.binary"
    #args:
    #  CARDANO_NODE_VERSION: "10.5.1"
    # Source version
    dockerfile: "cardano-node/Dockerfile.source"
    args:
      CARDANO_NODE_REF: "10.5.1"
x-base_eu: &base_eu
  <<: *base
  env_file:
    - env_eu.base
  dns:
    - 172.16.3.2
  networks:
    - eu_net
x-base_na: &base_na
  <<: *base
  env_file:
    - env_na.base
  dns:
    - 172.16.1.2
  networks:
    - na_net
x-base_as: &base_as
  <<: *base
  env_file:
    - env_as.base
  dns:
    - 172.16.4.2
  networks:
    - as_net
x-base_gw: &base_gw
    image: ${testnet}_gateway:latest
    restart: unless-stopped
    build:
      context: "../../"
      dockerfile: gateway/Dockerfile
    cap_add:
      - NET_ADMIN
      - NET_RAW
    sysctls:
      net.ipv4.ip_forward: "1"
networks:
  # Defalt Network
  # Used for communicating with the host
  default:
    driver: bridge
  # North America Network
  na_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.10
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.1.0/24
  # Link between Europe and North America
  eu_na_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.20
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.2.0/24
  # Europe Network
  eu_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.30
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.3.0/24
  # Asia Network
  as_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.40
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.4.0/24
  # Asia Europe Link
  as_eu_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.50
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.5.0/24
  # Asia North America Link
  as_na_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.60
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.6.0/24
  # Management Network
  mgmt_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.70
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.7.0/24
  # Management Asia Link
  ad_as_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.80
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.8.0/24
  # Management Europe Link
  ad_eu_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.90
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.9.0/24
  # Management North America Link
  ad_na_net:
    driver: macvlan
    driver_opts:
      parent: ${HOST_INTERFACE}.100
      macvlan_mode: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.16.10.0/24
services:
  # Pool 1
  # Block Producer
  p1bp:
    <<: *base_na
    container_name: p1bp
    hostname: p1bp.example
    volumes:
      - p1bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "1"
      TYPE: bp
      PEER_SHARING: "false"
      EGRESS_POLL_INTERVAL: 0.001
    networks:
      na_net:
        ipv4_address: 172.16.1.101
    profiles: [build, core, na, p1]
  # Relay
  p1r1:
    <<: *base_na
    container_name: p1r1
    hostname: p1r1.example
    volumes:
      - p1r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "1"
      RELAY_ID: "1"
      TYPE: relay
      EGRESS_POLL_INTERVAL: 0.001
    networks:
      na_net:
        ipv4_address: 172.16.1.102
    profiles: [build, core, na, p1, p1relays]
  # Relay
  p1r2:
    <<: *base_na
    container_name: p1r2
    hostname: p1r2.example
    volumes:
      - p1r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "1"
      RELAY_ID: "2"
      TYPE: relay
      EGRESS_POLL_INTERVAL: 0.001
    networks:
      na_net:
        ipv4_address: 172.16.1.103
    profiles: [build, core, na, p1, p1relays]
  # Relay
  p1r3:
    <<: *base_na
    container_name: p1r3
    hostname: p1r3.example
    volumes:
      - p1r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "1"
      RELAY_ID: "3"
      TYPE: privaterelay
      EGRESS_POLL_INTERVAL: 0.001
    networks:
      na_net:
        ipv4_address: 172.16.1.104
    profiles: [na, p1, p1relays, privaterelays]
  # Pool 2
  # Block Producer
  p2bp:
    <<: *base_eu
    container_name: p2bp
    hostname: p2bp.example
    volumes:
      - p2bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "2"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      eu_net:
        ipv4_address: 172.16.3.101
    profiles: [build, core, eu, p2]
  # Relay
  p2r1:
    <<: *base_eu
    container_name: p2r1
    hostname: p2r1.example
    volumes:
      - p2r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "2"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.102
    profiles: [build, core, eu, p2, p2relays]
  # Relay
  p2r2:
    <<: *base_eu
    container_name: p2r2
    hostname: p2r2.example
    volumes:
      - p2r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "2"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.103
    profiles: [build, core, eu, p2, p2relays]
  # Relay
  p2r3:
    <<: *base_eu
    container_name: p2r3
    hostname: p2r3.example
    volumes:
      - p2r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "2"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      eu_net:
        ipv4_address: 172.16.3.104
    profiles: [eu, p2, p2relays, privaterelays]
  # Pool 3
  # Block Producer
  p3bp:
    <<: *base_as
    container_name: p3bp
    hostname: p3bp.example
    volumes:
      - p3bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "3"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      as_net:
        ipv4_address: 172.16.4.101
    profiles: [build, core, as, p3]
  # Relay
  p3r1:
    <<: *base_as
    container_name: p3r1
    hostname: p3r1.example
    volumes:
      - p3r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "3"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.102
    profiles: [build, core, as, p3, p3relays]
  # Relay
  p3r2:
    <<: *base_as
    container_name: p3r2
    hostname: p3r2.example
    volumes:
      - p3r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "3"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.103
    profiles: [build, core, as, p3, p3relays]
  # Relay
  p3r3:
    <<: *base_as
    container_name: p3r3
    hostname: p3r3.example
    volumes:
      - p3r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "3"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      as_net:
        ipv4_address: 172.16.4.104
    profiles: [p3, p3relays, privaterelays]
  # Pool 4
  # Block Producer
  p4bp:
    <<: *base_eu
    container_name: p4bp
    hostname: p4bp.example
    volumes:
      - p4bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "4"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      eu_net:
        ipv4_address: 172.16.3.111
    profiles: [build, core, eu, p4]
  # Relay
  p4r1:
    <<: *base_eu
    container_name: p4r1
    hostname: p4r1.example
    volumes:
      - p4r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "4"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.112
    profiles: [build, core, eu, p4, p4relays]
  # Relay
  p4r2:
    <<: *base_eu
    container_name: p4r2
    hostname: p4r2.example
    volumes:
      - p4r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "4"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.113
    profiles: [build, core, eu, p4, p4relays]
  # Relay
  p4r3:
    <<: *base_eu
    container_name: p4r3
    hostname: p4r3.example
    volumes:
      - p4r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "4"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      eu_net:
        ipv4_address: 172.16.3.114
    profiles: [eu, p4, p4relays, privaterelays]
  # Pool 5
  # Block Producer
  p5bp:
    <<: *base_na
    container_name: p5bp
    hostname: p5bp.example
    volumes:
      - p5bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "5"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      na_net:
        ipv4_address: 172.16.1.111
    profiles: [build, core, na, p5]
  # Relay
  p5r1:
    <<: *base_na
    container_name: p5r1
    hostname: p5r1.example
    volumes:
      - p5r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "5"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.112
    profiles: [build, core, na, p5, p5relays]
  # Relay
  p5r2:
    <<: *base_na
    container_name: p5r2
    hostname: p5r2.example
    volumes:
      - p5r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "5"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.123
    profiles: [build, core, na, p5, p5relays]
  # Relay
  p5r3:
    <<: *base_na
    container_name: p5r3
    hostname: p5r3.example
    volumes:
      - p5r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "5"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      na_net:
        ipv4_address: 172.16.1.124
    profiles: [na, p5, p5relays, privaterelays]
  # Pool 6
  # Block Producer
  p6bp:
    <<: *base_eu
    container_name: p6bp
    hostname: p6bp.example
    volumes:
      - p6bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "6"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      eu_net:
        ipv4_address: 172.16.3.121
    profiles: [build, core, eu, p6]
  # Relay
  p6r1:
    <<: *base_eu
    container_name: p6r1
    hostname: p6r1.example
    volumes:
      - p6r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "6"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.122
    profiles: [build, core, eu, p6, p6relays]
  # Relay
  p6r2:
    <<: *base_eu
    container_name: p6r2
    hostname: p6r2.example
    volumes:
      - p6r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "6"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.123
    profiles: [build, core, eu, p6, p6relays]
  # Relay
  p6r3:
    <<: *base_eu
    container_name: p6r3
    hostname: p6r3.example
    volumes:
      - p6r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "6"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      eu_net:
        ipv4_address: 172.16.3.124
    profiles: [eu, p6, p6relays, privaterelays]
  # Pool 7
  # Block Producer
  p7bp:
    <<: *base_as
    container_name: p7bp
    hostname: p7bp.example
    volumes:
      - p7bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "7"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      as_net:
        ipv4_address: 172.16.4.111
    profiles: [build, core, as, p7]
  # Relay
  p7r1:
    <<: *base_as
    container_name: p7r1
    hostname: p7r1.example
    volumes:
      - p7r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "7"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.112
    profiles: [build, core, as, p7, p7relays]
  # Relay
  p7r2:
    <<: *base_as
    container_name: p7r2
    hostname: p7r2.example
    volumes:
      - p7r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "7"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.113
    profiles: [build, core, as, p7, p7relays]
  # Relay
  p7r3:
    <<: *base_as
    container_name: p7r3
    hostname: p7r3.example
    volumes:
      - p7r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "7"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      as_net:
        ipv4_address: 172.16.4.114
    profiles: [as, p7, p7relays, privaterelays]
  # Pool 8
  # Block Producer
  p8bp:
    <<: *base_na
    container_name: p8bp
    hostname: p8bp.example
    volumes:
      - p8bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "8"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      na_net:
        ipv4_address: 172.16.1.131
    profiles: [build, core, na, p8]
  # Relay
  p8r1:
    <<: *base_na
    container_name: p8r1
    hostname: p8r1.example
    volumes:
      - p8r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "8"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.132
    profiles: [build, core, na, p8, p8relays]
  # Relay
  p8r2:
    <<: *base_na
    container_name: p8r2
    hostname: p8r2.example
    volumes:
      - p8r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "8"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.133
    profiles: [build, core, na, p8, p8relays]
  # Relay
  p8r3:
    <<: *base_na
    container_name: p8r3
    hostname: p8r3.example
    volumes:
      - p8r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "8"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      na_net:
        ipv4_address: 172.16.1.134
    profiles: [na, p8, p8relays, privaterelays]
  # Pool 9
  # Block Producer
  p9bp:
    <<: *base_eu
    container_name: p9bp
    hostname: p9bp.example
    volumes:
      - p9bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "9"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      eu_net:
        ipv4_address: 172.16.3.131
    profiles: [build, core, eu, p9]
  # Relay
  p9r1:
    <<: *base_eu
    container_name: p9r1
    hostname: p9r1.example
    volumes:
      - p9r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "9"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.132
    profiles: [build, core, eu, p9, p9relays]
  # Relay
  p9r2:
    <<: *base_eu
    container_name: p9r2
    hostname: p9r2.example
    volumes:
      - p9r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "9"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.133
    profiles: [build, core, eu, p9, p9relays]
  # Relay
  p9r3:
    <<: *base_eu
    container_name: p9r3
    hostname: p9r3.example
    volumes:
      - p9r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "9"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      eu_net:
        ipv4_address: 172.16.3.134
    profiles: [eu, p9, p9relays, privaterelays]
  # Pool 10
  # Block Producer
  p10bp:
    <<: *base_as
    container_name: p10bp
    hostname: p10bp.example
    volumes:
      - p10bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "10"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      as_net:
        ipv4_address: 172.16.4.121
    profiles: [build, core, as, p10]
  # Relay
  p10r1:
    <<: *base_as
    container_name: p10r1
    hostname: p10r1.example
    volumes:
      - p10r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "10"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.122
    profiles: [build, core, as, p10, p10relays]
  # Relay
  p10r2:
    <<: *base_as
    container_name: p10r2
    hostname: p10r2.example
    volumes:
      - p10r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "10"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.123
    profiles: [build, core, as, p10, p10relays]
  # Relay
  p10r3:
    <<: *base_as
    container_name: p10r3
    hostname: p10r3.example
    volumes:
      - p10r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "10"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      as_net:
        ipv4_address: 172.16.4.124
    profiles: [as, p10, p10relays, privaterelays]
  # Pool 11
  # Block Producer
  p11bp:
    <<: *base_na
    container_name: p11bp
    hostname: p11bp.example
    volumes:
      - p11bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "11"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      na_net:
        ipv4_address: 172.16.1.141
    profiles: [build, core, na, p11]
  # Relay
  p11r1:
    <<: *base_na
    container_name: p11r1
    hostname: p11r1.example
    volumes:
      - p11r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "11"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.142
    profiles: [build, core, na, p11, p11relays]
  # Relay
  p11r2:
    <<: *base_na
    container_name: p11r2
    hostname: p11r2.example
    volumes:
      - p11r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "11"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.143
    profiles: [build, core, na, p11, p11relays]
  # Relay
  p11r3:
    <<: *base_na
    container_name: p11r3
    hostname: p11r3.example
    volumes:
      - p11r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "11"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      na_net:
        ipv4_address: 172.16.1.144
    profiles: [na, p11, p11relays, privaterelays]
  # Pool 12
  # Block Producer
  p12bp:
    <<: *base_eu
    container_name: p12bp
    hostname: p12bp.example
    volumes:
      - p12bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "12"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      eu_net:
        ipv4_address: 172.16.3.141
    profiles: [build, core, eu, p12]
  # Relay
  p12r1:
    <<: *base_eu
    container_name: p12r1
    hostname: p12r1.example
    volumes:
      - p12r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "12"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.142
    profiles: [build, core, eu, p12, p12relays]
  # Relay
  p12r2:
    <<: *base_eu
    container_name: p12r2
    hostname: p12r2.example
    volumes:
      - p12r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "12"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.143
    profiles: [build, core, eu, p12, p12relays]
  # Relay
  p12r3:
    <<: *base_eu
    container_name: p12r3
    hostname: p12r3.example
    volumes:
      - p12r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "12"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      eu_net:
        ipv4_address: 172.16.3.144
    profiles: [eu, p12, p12relays, privaterelays]
  # Pool 13
  # Block Producer
  p13bp:
    <<: *base_as
    container_name: p13bp
    hostname: p13bp.example
    volumes:
      - p13bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "13"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      as_net:
        ipv4_address: 172.16.4.131
    profiles: [build, core, as, p13]
  # Relay
  p13r1:
    <<: *base_as
    container_name: p13r1
    hostname: p13r1.example
    volumes:
      - p13r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "13"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.132
    profiles: [build, core, as, p13, p13relays]
  # Relay
  p13r2:
    <<: *base_as
    container_name: p13r2
    hostname: p13r2.example
    volumes:
      - p13r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "13"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.133
    profiles: [build, core, as, p13, p13relays]
  # Relay
  p13r3:
    <<: *base_as
    container_name: p13r3
    hostname: p13r3.example
    volumes:
      - p13r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "13"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      as_net:
        ipv4_address: 172.16.4.134
    profiles: [as, p13, p13relays, privaterelays]
  # Pool 14
  # Block Producer
  p14bp:
    <<: *base_na
    container_name: p14bp
    hostname: p14bp.example
    volumes:
      - p14bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "14"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      na_net:
        ipv4_address: 172.16.1.151
    profiles: [build, core, na, p14]
  # Relay
  p14r1:
    <<: *base_na
    container_name: p14r1
    hostname: p14r1.example
    volumes:
      - p14r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "14"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.152
    profiles: [build, core, na, p14, p14relays]
  # Relay
  p14r2:
    <<: *base_na
    container_name: p14r2
    hostname: p14r2.example
    volumes:
      - p14r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "14"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.153
    profiles: [build, core, na, p14, p14relays]
  # Relay
  p14r3:
    <<: *base_na
    container_name: p14r3
    hostname: p14r3.example
    volumes:
      - p14r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "14"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      na_net:
        ipv4_address: 172.16.1.154
    profiles: [na, p14, p14relays, privaterelays]
  # Pool 15
  # Block Producer
  p15bp:
    <<: *base_eu
    container_name: p15bp
    hostname: p15bp.example
    volumes:
      - p15bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "15"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      eu_net:
        ipv4_address: 172.16.3.151
    profiles: [build, core, eu, p15]
  # Relay
  p15r1:
    <<: *base_eu
    container_name: p15r1
    hostname: p15r1.example
    volumes:
      - p15r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "15"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.152
    profiles: [build, core, eu, p15, p15relays]
  # Relay
  p15r2:
    <<: *base_eu
    container_name: p15r2
    hostname: p15r2.example
    volumes:
      - p15r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "15"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.153
    profiles: [build, core, eu, p15, p15relays]
  # Relay
  p15r3:
    <<: *base_eu
    container_name: p15r3
    hostname: p15r3.example
    volumes:
      - p15r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "15"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      eu_net:
        ipv4_address: 172.16.3.154
    profiles: [eu, p15, p15relays, privaterelays]
  # Pool 16
  # Block Producer
  p16bp:
    <<: *base_as
    container_name: p16bp
    hostname: p16bp.example
    volumes:
      - p16bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "16"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      as_net:
        ipv4_address: 172.16.4.141
    profiles: [build, core, as, p16]
  # Relay
  p16r1:
    <<: *base_as
    container_name: p16r1
    hostname: p16r1.example
    volumes:
      - p16r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "16"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.142
    profiles: [build, core, as, p16, p16relays]
  # Relay
  p16r2:
    <<: *base_as
    container_name: p16r2
    hostname: p16r2.example
    volumes:
      - p16r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "16"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.143
    profiles: [build, core, as, p16, p16relays]
  # Relay
  p16r3:
    <<: *base_as
    container_name: p16r3
    hostname: p16r3.example
    volumes:
      - p16r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "16"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      as_net:
        ipv4_address: 172.16.4.144
    profiles: [as, p16, p16relays, privaterelays]
  # Pool 17
  # Block Producer
  p17bp:
    <<: *base_na
    container_name: p17bp
    hostname: p17bp.example
    volumes:
      - p17bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "17"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      na_net:
        ipv4_address: 172.16.1.161
    profiles: [build, core, na, p17]
  # Relay
  p17r1:
    <<: *base_na
    container_name: p17r1
    hostname: p17r1.example
    volumes:
      - p17r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "17"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.162
    profiles: [build, core, na, p17, p17relays]
  # Relay
  p17r2:
    <<: *base_na
    container_name: p17r2
    hostname: p17r2.example
    volumes:
      - p17r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "17"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.163
    profiles: [build, core, na, p17, p17relays]
  # Relay
  p17r3:
    <<: *base_na
    container_name: p17r3
    hostname: p17r3.example
    volumes:
      - p17r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "17"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      na_net:
        ipv4_address: 172.16.1.164
    profiles: [na, p17, p17relays, privaterelays]
  # Pool 18
  # Block Producer
  p18bp:
    <<: *base_eu
    container_name: p18bp
    hostname: p18bp.example
    volumes:
      - p18bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "18"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      eu_net:
        ipv4_address: 172.16.3.161
    profiles: [build, core, eu, p18]
  # Relay
  p18r1:
    <<: *base_eu
    container_name: p18r1
    hostname: p18r1.example
    volumes:
      - p18r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "18"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.162
    profiles: [build, core, eu, p18, p18relays]
  # Relay
  p18r2:
    <<: *base_eu
    container_name: p18r2
    hostname: p18r2.example
    volumes:
      - p18r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "18"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.163
    profiles: [build, core, eu, p18, p18relays]
  # Relay
  p18r3:
    <<: *base_eu
    container_name: p18r3
    hostname: p18r3.example
    volumes:
      - p18r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "18"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      eu_net:
        ipv4_address: 172.16.3.164
    profiles: [eu, p18, p18relays, privaterelays]
  # Pool 19
  # Block Producer
  p19bp:
    <<: *base_as
    container_name: p19bp
    hostname: p19bp.example
    volumes:
      - p19bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "19"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      as_net:
        ipv4_address: 172.16.4.151
    profiles: [build, core, as, p19]
  # Relay
  p19r1:
    <<: *base_as
    container_name: p19r1
    hostname: p19r1.example
    volumes:
      - p19r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "19"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.152
    profiles: [build, core, as, p19, p19relays]
  # Relay
  p19r2:
    <<: *base_as
    container_name: p19r2
    hostname: p19r2.example
    volumes:
      - p19r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "19"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.153
    profiles: [build, core, as, p19, p19relays]
  # Relay
  p19r3:
    <<: *base_as
    container_name: p19r3
    hostname: p19r3.example
    volumes:
      - p19r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "19"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      as_net:
        ipv4_address: 172.16.4.154
    profiles: [as, p19, p19relays, privaterelays]
  # Pool 20
  # Block Producer
  p20bp:
    <<: *base_na
    container_name: p20bp
    hostname: p20bp.example
    volumes:
      - p20bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "20"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      na_net:
        ipv4_address: 172.16.1.171
    profiles: [build, core, na, p20]
  # Relay
  p20r1:
    <<: *base_na
    container_name: p20r1
    hostname: p20r1.example
    volumes:
      - p20r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "20"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.172
    profiles: [build, core, na, p20, p20relays]
  # Relay
  p20r2:
    <<: *base_na
    container_name: p20r2
    hostname: p20r2.example
    volumes:
      - p20r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "20"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.173
    profiles: [build, core, na, p20, p20relays]
  # Relay
  p20r3:
    <<: *base_na
    container_name: p20r3
    hostname: p20r3.example
    volumes:
      - p20r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "20"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      na_net:
        ipv4_address: 172.16.1.174
    profiles: [na, p20, p20relays, privaterelays]
  # Pool 21
  # Block Producer
  p21bp:
    <<: *base_eu
    container_name: p21bp
    hostname: p21bp.example
    volumes:
      - p21bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "21"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      eu_net:
        ipv4_address: 172.16.3.171
    profiles: [build, core, eu, p21]
  # Relay
  p21r1:
    <<: *base_eu
    container_name: p21r1
    hostname: p21r1.example
    volumes:
      - p21r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "21"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.172
    profiles: [build, core, eu, p21, p21relays]
  # Relay
  p21r2:
    <<: *base_eu
    container_name: p21r2
    hostname: p21r2.example
    volumes:
      - p21r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "21"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      eu_net:
        ipv4_address: 172.16.3.173
    profiles: [build, core, eu, p21, p21relays]
  # Relay
  p21r3:
    <<: *base_eu
    container_name: p21r3
    hostname: p21r3.example
    volumes:
      - p21r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "21"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      eu_net:
        ipv4_address: 172.16.3.174
    profiles: [eu, p21, p21relays, privaterelays]
  # Pool 22
  # Block Producer
  p22bp:
    <<: *base_as
    container_name: p22bp
    hostname: p22bp.example
    volumes:
      - p22bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "22"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      as_net:
        ipv4_address: 172.16.4.161
    profiles: [build, core, as, p22]
  # Relay
  p22r1:
    <<: *base_as
    container_name: p22r1
    hostname: p22r1.example
    volumes:
      - p22r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "22"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.162
    profiles: [build, core, as, p22, p22relays]
  # Relay
  p22r2:
    <<: *base_as
    container_name: p22r2
    hostname: p22r2.example
    volumes:
      - p22r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "22"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.163
    profiles: [build, core, as, p22, p22relays]
  # Relay
  p22r3:
    <<: *base_as
    container_name: p22r3
    hostname: p22r3.example
    volumes:
      - p22r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "22"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      as_net:
        ipv4_address: 172.16.4.164
    profiles: [as, p22, p22relays, privaterelays]
  # Pool 23
  # Block Producer
  p23bp:
    <<: *base_na
    container_name: p23bp
    hostname: p23bp.example
    volumes:
      - p23bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "23"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      na_net:
        ipv4_address: 172.16.1.181
    profiles: [build, core, na, p23]
  # Relay
  p23r1:
    <<: *base_na
    container_name: p23r1
    hostname: p23r1.example
    volumes:
      - p23r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "23"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.182
    profiles: [build, core, na, p23, p23relays]
  # Relay
  p23r2:
    <<: *base_na
    container_name: p23r2
    hostname: p23r2.example
    volumes:
      - p23r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "23"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      na_net:
        ipv4_address: 172.16.1.183
    profiles: [build, core, na, p23, p23relays]
  # Relay
  p23r3:
    <<: *base_na
    container_name: p23r3
    hostname: p23r3.example
    volumes:
      - p23r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "23"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      na_net:
        ipv4_address: 172.16.1.184
    profiles: [na, p23, p23relays, privaterelays]
  # Pool 24
  # Block Producer
  p24bp:
    <<: *base_as
    container_name: p24bp
    hostname: p24bp.example
    volumes:
      - p24bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "24"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      as_net:
        ipv4_address: 172.16.4.171
    profiles: [build, core, as, p24]
  # Relay
  p24r1:
    <<: *base_as
    container_name: p24r1
    hostname: p24r1.example
    volumes:
      - p24r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "24"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.172
    profiles: [build, core, as, p24, p24relays]
  # Relay
  p24r2:
    <<: *base_as
    container_name: p24r2
    hostname: p24r2.example
    volumes:
      - p24r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "24"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.173
    profiles: [build, core, as, p24, p24relays]
  # Relay
  p24r3:
    <<: *base_as
    container_name: p24r3
    hostname: p24r3.example
    volumes:
      - p24r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "24"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      as_net:
        ipv4_address: 172.16.4.174
    profiles: [as, p24, p24relays, privaterelays]
  # Pool 25
  # Block Producer
  p25bp:
    <<: *base_as
    container_name: p25bp
    hostname: p25bp.example
    volumes:
      - p25bp:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "25"
      TYPE: bp
      PEER_SHARING: "false"
    networks:
      as_net:
        ipv4_address: 172.16.4.175
    profiles: [build, core, as, p25]
  # Relay
  p25r1:
    <<: *base_as
    container_name: p25r1
    hostname: p25r1.example
    volumes:
      - p25r1:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "25"
      RELAY_ID: "1"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.176
    profiles: [build, core, as, p25, p25relays]
  # Relay
  p25r2:
    <<: *base_as
    container_name: p25r2
    hostname: p25r2.example
    volumes:
      - p25r2:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "25"
      RELAY_ID: "2"
      TYPE: relay
    networks:
      as_net:
        ipv4_address: 172.16.4.177
    profiles: [build, core, as, p25, p25relays]
  # Relay
  p25r3:
    <<: *base_as
    container_name: p25r3
    hostname: p25r3.example
    volumes:
      - p25r3:/opt/cardano-node/data
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "25"
      RELAY_ID: "3"
      TYPE: privaterelay
    networks:
      as_net:
        ipv4_address: 172.16.4.178
    profiles: [as, p25, p25relays, privaterelays]
  # North America Gateway
  nagw:
    <<: *base_gw
    container_name: nagw
    hostname: nagw.example
    environment:
      GATEWAY_ID: "nagw"
    networks:
      na_net:
        ipv4_address: 172.16.1.11
      eu_na_net:
        interface_name: eunax0
        ipv4_address: 172.16.2.11
      as_na_net:
        interface_name: asnax0
        ipv4_address: 172.16.6.11
      ad_na_net:
        ipv4_address: 172.16.10.11
    dns:
      - 172.16.1.2
    profiles: [build, core, na, gateways]
  # Europe Gateway
  eugw:
    <<: *base_gw
    container_name: eugw
    hostname: eugw.example
    environment:
      GATEWAY_ID: "eugw"
    networks:
      eu_net:
        ipv4_address: 172.16.3.12
      eu_na_net:
        interface_name: eunax0
        ipv4_address: 172.16.2.12
      as_eu_net:
        interface_name: aseux0
        ipv4_address: 172.16.5.12
      ad_eu_net:
        ipv4_address: 172.16.9.12
    dns:
      - 172.16.2.2
    profiles: [build, core, eu, gateways]
  # Asia Gateway
  asgw:
    <<: *base_gw
    container_name: asgw
    hostname: asgw.example
    environment:
      GATEWAY_ID: "asgw"
    networks:
      as_net:
        ipv4_address: 172.16.4.13
      as_eu_net:
        interface_name: aseux0
        ipv4_address: 172.16.5.13
      as_na_net:
        interface_name: asnax0
        ipv4_address: 172.16.6.13
      ad_as_net:
        ipv4_address: 172.16.8.13
    dns:
      - 172.16.4.2
    profiles: [build, core, as, gateways]
  # Management Gateway
  adgw:
    <<: *base_gw
    container_name: adgw
    hostname: adgw.example
    environment:
      GATEWAY_ID: "adgw"
    networks:
      mgmt_net:
        ipv4_address: 172.16.7.14
      ad_as_net:
        ipv4_address: 172.16.8.14
      ad_eu_net:
        ipv4_address: 172.16.9.14
      ad_na_net:
        ipv4_address: 172.16.10.14
    dns:
      - 172.16.7.2
    profiles: [build, core, mgmt, gateways]
  # DNS Server
  ns:
    image: coredns/coredns:1.12.2
    container_name: ns
    hostname: ns.example
    restart: unless-stopped
    command: -conf /etc/coredns/corefile
    volumes:
      - ./coredns:/etc/coredns # Mount custom corefile
    networks:
      na_net:
        ipv4_address: 172.16.1.2
      eu_na_net:
        ipv4_address: 172.16.2.2
      eu_net:
        ipv4_address: 172.16.3.2
      as_net:
        ipv4_address: 172.16.4.2
      mgmt_net:
        ipv4_address: 172.16.7.2
    profiles: [build, core, mgmt]
  sidecar:
    image: ${testnet}_sidecar:latest
    container_name: sidecar
    hostname: sidecar.example
    restart: unless-stopped
    build:
      context: "../../"
      dockerfile: "sidecar/Dockerfile"
    environment:
      TOPOLOGY: "fancy"
      POOLS: "24"  # Updated from 6 to 24
    volumes:
      - synth:/opt/synth:ro
    cap_add:
      - NET_ADMIN
    networks:
      mgmt_net:
        ipv4_address: 172.16.7.3
    dns:
      - 172.16.7.2
    depends_on:
      db:
        condition: service_started
    profiles: [build, core, mgmt]
  synth:
    image: ${testnet}_db-synthesizer:latest
    container_name: synth
    restart: no
    environment:
      SYSTEM_START: ${SYSTEM_START:-}
      PRE_EPOCHS: ${PRE_EPOCHS:-0}
    volumes:
      - synth:/opt/cardano-node/data
    build:
      context: "../../"
      dockerfile: "db-synthesizer/Dockerfile"
    profiles: [build, core, mgmt]
  # Client 1
  # Used by cardano-db-sync
  c1:
    <<: *base_eu
    container_name: c1
    hostname: c1.example
    volumes:
      - c1:/opt/cardano-node
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "1"
      TYPE: "client"
      UTXOHD: "true"
      SYSTEM_START: ${SYSTEM_START:-}
    networks:
      eu_net:
        ipv4_address: 172.16.3.4
    profiles: [build, core, eu]
  # TX generator 1
  c2:
    <<: *base_na
    container_name: c2
    hostname: c2.example
    volumes:
      - c2:/opt/cardano-node
      - synth:/opt/synth:ro
    environment:
      POOL_ID: "1"
      TYPE: "txg"
      TPS: "1"
      TX_GEN_MODE: "plain"
      #TX_GEN_MODE: "plutus"
      UTXOHD: "true"
      SYSTEM_START: ${SYSTEM_START:-}
    networks:
      na_net:
        ipv4_address: 172.16.1.12
    profiles: [build, na, optional, tx-generators]
  # PostgreSQL Database
  db:
    image: postgresql:latest
    container_name: db
    hostname: db.example
    restart: unless-stopped
    volumes:
      - db:/opt/postgresql
    build:
      context: "../../"
      dockerfile: "postgresql/Dockerfile"
    networks:
      eu_net:
        ipv4_address: 172.16.3.5
      na_net:
        ipv4_address: 172.16.1.5
      as_net:
        ipv4_address: 172.16.4.5
      mgmt_net:
        ipv4_address: 172.16.7.5
    dns:
      - 172.16.7.2
    profiles: [build, core, mgmt]
  dbsync:
    image: cardano-db-sync:latest
    container_name: dbsync
    hostname: dbsync.example
    restart: unless-stopped
    volumes:
      - dbsync:/opt/cardano-db-sync
      - c1:/opt/cardano-node
    environment:
      DB_HOST: "db.example"
    build:
      context: "../../"
      dockerfile: "cardano-db-sync/Dockerfile.binary"
    networks:
      mgmt_net:
        ipv4_address: 172.16.7.6
    dns:
      - 172.16.7.2
    depends_on:
      db:
        condition: service_started
    profiles: [build, core, mgmt]
  blockfrost:
    image: blockfrost:latest
    container_name: blockfrost
    hostname: blockfrost.example
    restart: unless-stopped
    volumes:
      - c1:/opt/cardano-node
    environment:
      DB_HOST: "db.example"
    build:
      context: "../../"
      dockerfile: "blockfrost/Dockerfile"
    networks:
      mgmt_net:
        ipv4_address: 172.16.7.7
    profiles: [build, optional, mgmt]
  prometheus:
    image: prom/prometheus:v3.5.0
    container_name: prometheus
    hostname: prometheus.example
    restart: unless-stopped
    volumes:
      - prometheus:/prometheus
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
    networks:
      eu_net:
        ipv4_address: 172.16.3.8
      na_net:
        ipv4_address: 172.16.1.8
      as_net:
        ipv4_address: 172.16.4.8
      mgmt_net:
        ipv4_address: 172.16.7.8
    dns:
      - 172.16.7.2
    depends_on:
      blackbox:
        condition: service_started
    profiles: [build, core, mgmt]
  blackbox:
    image: quay.io/prometheus/blackbox-exporter:v0.27.0
    container_name: blackbox
    hostname: blackbox.example
    restart: unless-stopped
    command: --config.file=/etc/blackbox_exporter/blackbox.yml
    volumes:
      - ../../blackbox:/etc/blackbox_exporter/
    cap_add:
      - NET_ADMIN
      - NET_RAW
    networks:
      eu_net:
        ipv4_address: 172.16.3.9
      na_net:
        ipv4_address: 172.16.1.9
      as_net:
        ipv4_address: 172.16.4.9
      mgmt_net:
        ipv4_address: 172.16.7.9
    dns:
      - 172.16.7.2
    profiles: [build, core, mgmt]
  loki:
    image: grafana/loki:3.5.3
    container_name: loki
    hostname: loki.example
    restart: unless-stopped
    command: -config.file=/etc/loki/local-config.yaml
    ports:
      - "${LOKI_HOST:-3100}:3100"
    volumes:
      - loki:/loki
    networks:
      default:
      mgmt_net:
        ipv4_address: 172.16.7.10
    dns:
      - 172.16.7.2
    profiles: [build, core, mgmt]
  grafana:
    image: grafana/grafana:12.1.0
    container_name: grafana
    hostname: grafana.example
    restart: unless-stopped
    ports:
      - "${GRAFANA_HOST:-3000}:3000"
    volumes:
      - grafana:/var/lib/grafana
      - ../../grafana/provisioning:/etc/grafana/provisioning
    environment:
      GF_SECURITY_ADMIN_USER: cardano
      GF_SECURITY_ADMIN_PASSWORD: cardano
    networks:
      default:
      mgmt_net:
        ipv4_address: 172.16.7.11
    dns:
      - 172.16.7.2
    profiles: [build, core, mgmt]
  yaci:
    image: yaci-store:latest
    container_name: yaci
    hostname: yaci.example
    restart: unless-stopped
    volumes:
      - c1:/opt/cardano-node
      - ../../yaci-store/application.properties:/opt/yaci/config/application.properties
      - ../../yaci-store/application-ledger-state.properties:/opt/yaci/config/application-ledger-state.properties
    build:
      context: "../../"
      dockerfile: "yaci-store/Dockerfile.binary"
    environment:
      REGION: EU
    cap_add:
      - NET_ADMIN
    networks:
      eu_net:
        ipv4_address: 172.16.3.22
    dns:
      - 172.16.3.2
    profiles: [build, optional]
volumes:
  p1bp:
  p1r1:
  p1r2:
  p1r3:
  p2bp:
  p2r1:
  p2r2:
  p2r3:
  p3bp:
  p3r1:
  p3r2:
  p3r3:
  p4bp:
  p4r1:
  p4r2:
  p4r3:
  p5bp:
  p5r1:
  p5r2:
  p5r3:
  p6bp:
  p6r1:
  p6r2:
  p6r3:
  p7bp:
  p7r1:
  p7r2:
  p7r3:
  p8bp:
  p8r1:
  p8r2:
  p8r3:
  p9bp:
  p9r1:
  p9r2:
  p9r3:
  p10bp:
  p10r1:
  p10r2:
  p10r3:
  p11bp:
  p11r1:
  p11r2:
  p11r3:
  p12bp:
  p12r1:
  p12r2:
  p12r3:
  p13bp:
  p13r1:
  p13r2:
  p13r3:
  p14bp:
  p14r1:
  p14r2:
  p14r3:
  p15bp:
  p15r1:
  p15r2:
  p15r3:
  p16bp:
  p16r1:
  p16r2:
  p16r3:
  p17bp:
  p17r1:
  p17r2:
  p17r3:
  p18bp:
  p18r1:
  p18r2:
  p18r3:
  p19bp:
  p19r1:
  p19r2:
  p19r3:
  p20bp:
  p20r1:
  p20r2:
  p20r3:
  p21bp:
  p21r1:
  p21r2:
  p21r3:
  p22bp:
  p22r1:
  p22r2:
  p22r3:
  p23bp:
  p23r1:
  p23r2:
  p23r3:
  p24bp:
  p24r1:
  p24r2:
  p24r3:
  p25bp:
  p25r1:
  p25r2:
  p25r3:
  c1:
  c2:
  db:
  dbsync:
  prometheus:
  loki:
  grafana:
  synth:
